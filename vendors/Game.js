var GAME=GAME||Object.create(null);GAME.Input=GAME.Input||Object.create(null),GAME.Input.Key={Left:37,Top:38,Right:39,Bottom:40},GAME.Input.Keyset={AZERTY:[GAME.Input.Key.Q,GAME.Input.Key.Z,GAME.Input.Key.D,GAME.Input.Key.S],QWERTY:[GAME.Input.Key.A,GAME.Input.Key.W,GAME.Input.Key.D,GAME.Input.Key.S],Left:[GAME.Input.Key.A,GAME.Input.Key.Q,GAME.Input.Key.Left],Top:[GAME.Input.Key.Z,GAME.Input.Key.W,GAME.Input.Key.Top],Right:[GAME.Input.Key.D,GAME.Input.Key.Right],Bottom:[GAME.Input.Key.S,GAME.Input.Key.Bottom]};var GAME=GAME||Object.create(null);GAME.Input=GAME.Input||Object.create(null),GAME.Input.Keyboard=function(){var t=Object.create(null);return $(window).on("keydown",function(e){t[e.keyCode]={locked:!1}}),$(window).on("keyup",function(e){delete t[e.keyCode]}),{any:function(t){return t.some(this.pressed.bind(this))},pressed:function(e,n){return!t[e]||t[e].locked?!1:(n&&(t[e].locked=!0),!0)}}}();var GAME=GAME||Object.create(null);GAME.Loading=GAME.Loading||Object.create(null),GAME.Loading.Loader=function(){this.weight=0,this.tasks=[],GAME.event(this).add("begin").add("progress").add("complete")},GAME.Loading.Loader.prototype.push=function(t){var e=Array.prototype.slice.call(arguments,1),n=Function.prototype.bind.apply(GAME.Loading[t],[null].concat(e)),i=new n;return this.weight+=i.weight,this.tasks.push(i),this},GAME.Loading.Loader.prototype.start=function(t){var e=this.weight;this.weight=0;var n=this.tasks;this.tasks=[];var i=Object.create(null),s=0,a=0,o=null,u=function(r){r===void 0&&(r=1);var c=s+(o?o.weight:0)*r,h=c/e;return this.progress(h),1===r&&(s=c,a=h),1===r&&1!==a?(o=n.shift(),o.start(i,u)):1===a&&(this.complete(i),t&&t(i)),this}.bind(this);return this.begin(),u(),this};var GAME=GAME||Object.create(null);GAME.Loading=GAME.Loading||Object.create(null),GAME.Loading.deferred=function(t,e){e===void 0&&(e=1),this.weight=e,this.start=t};var GAME=GAME||Object.create(null);GAME.Loading=GAME.Loading||Object.create(null),GAME.Loading.direct=function(t,e){e===void 0&&(e=1),this.weight=e,this.start=function(e,n){t(e),n()}};var GAME=GAME||Object.create(null);GAME.Loading=GAME.Loading||Object.create(null),GAME.Loading.ready=function(){this.weight=1,this.start=function(t,e){$(document).ready(function(){e()})}};var GAME=GAME||Object.create(null);GAME.Loading=GAME.Loading||Object.create(null),GAME.Loading.texture=function(t,e){this.weight=1,this.start=function(n,i){THREE.ImageUtils.loadTexture(e,null,function(e){n[t]=e,i()})}};var GAME=GAME||Object.create(null);GAME.Loop=function(t,e){this.clock=new THREE.Clock,this.timer=t,this.id=null,this.fn=e,this.start()},GAME.Loop.repaint=function(){return window.requestAnimationFrame?{set:function(t){return window.requestAnimationFrame(t)},unset:function(t){window.cancelRequestAnimationFrame(t)}}:GAME.Loop.fps(60)},GAME.Loop.fps=function(t){return{set:function(e){return window.setTimeout(e,1e3/t)},unset:function(t){window.clearTimeout(t)}}},GAME.Loop.prototype.start=function(){return null!==this.id?this:(this.fn(this.clock.getDelta()),this.timer.set(function(){this.id=null,this.start()}.bind(this)),this)},GAME.Loop.prototype.pause=function(){return null===this.id?this:(this.clock.stop(),this.timer.unset(this.id),this.id=null,this)};var GAME=GAME||Object.create(null);GAME.State=GAME.State||Object.create(null),GAME.State.Machine=function(){},GAME.State.Machine.prototype.takeState=function(){var t=this.state;return this.state=null,this.state.sleep&&this.state.sleep(),this.state.zzz=!0,t},GAME.State.Machine.prototype.setState=function(t){return this.state&&this.state.destruct&&this.state.destruct(),this.state=t,this.state&&(this.state.zzz?(this.state.zzz=!1,this.state.wakeUp&&this.state.wakeUp()):this.state.construct&&this.state.construct()),this},GAME.State.Machine.prototype.update=function(){return this.state?this.state.update?(this.state.update.apply(this.state,arguments),this):this:this};var GAME=GAME||Object.create(null);GAME.event=function(t){return{add:function(e){var n=[];return t[e]=function(t){return"function"==typeof t?n.push(t):n.forEach(function(t,e){e.apply(this,t)}.bind(this,arguments)),this},this}}};