var GAME=GAME||Object.create(null);GAME.Button={Left:0,Middle:0,Right:0};var GAME=GAME||Object.create(null);GAME.Key={D0:48,D1:49,D2:50,D3:51,D4:52,D5:53,D6:54,D7:55,D8:56,D9:57,NumPad0:96,NumPad1:97,NumPad2:98,NumPad3:99,NumPad4:100,NumPad5:101,NumPad6:102,NumPad7:103,NumPad8:104,NumPad9:105,Left:37,Up:38,Right:39,Down:40,Space:32,Backspace:8,Enter:13},GAME.Keyset={AZERTY:[GAME.Key.Q,GAME.Key.Z,GAME.Key.D,GAME.Key.S],QWERTY:[GAME.Key.A,GAME.Key.W,GAME.Key.D,GAME.Key.S],Left:[GAME.Key.A,GAME.Key.Q,GAME.Key.Left],Top:[GAME.Key.Z,GAME.Key.W,GAME.Key.Up],Right:[GAME.Key.D,GAME.Key.Right],Bottom:[GAME.Key.S,GAME.Key.Down]};var GAME=GAME||Object.create(null);GAME.Loader=function(){this.weight=0,this.tasks=[],GAME.event(this).add("begin").add("progress").add("complete")},GAME.Loader.prototype.push=function(t){var e=Array.prototype.slice.call(arguments,1),n=Function.prototype.bind.apply(GAME.Loader[t],[null].concat(e)),i=new n;return this.weight+=i.weight,this.tasks.push(i),this},GAME.Loader.prototype.start=function(t){var e=this.weight;this.weight=0;var n=this.tasks;this.tasks=[];var i=Object.create(null),s=0,o=0,r=null,a=function(u){u===void 0&&(u=1);var c=s+(r?r.weight:0)*u,h=c/e;return this.progress(h),1===u&&(s=c,o=h),1===u&&1!==o?(r=n.shift(),r.start(i,a)):1===o&&(this.complete(i),t&&t(i)),this}.bind(this);return this.begin(),a(),this},GAME.Loader.deferred=function(t,e){e===void 0&&(e=1),this.weight=e,this.start=t},GAME.Loader.direct=function(t,e){e===void 0&&(e=1),this.weight=e,this.start=function(e,n){t(e),n()}},GAME.Loader.ready=function(){this.weight=1,this.start=function(t,e){$(document).ready(function(){e()})}},GAME.Loader.texture=function(t,e){this.weight=1,this.start=function(n,i){THREE.ImageUtils.loadTexture(e,null,function(e){n[t]=e,i()})}};var GAME=GAME||Object.create(null);GAME.Loop=function(t,e){this.clock=new THREE.Clock,this.timer=t,this.id=null,this.fn=e,this.start()},GAME.Loop.repaint=function(){return window.requestAnimationFrame?{set:function(t){return window.requestAnimationFrame(t)},unset:function(t){window.cancelRequestAnimationFrame(t)}}:GAME.Loop.fps(60)},GAME.Loop.fps=function(t){return{set:function(e){return window.setTimeout(e,1e3/t)},unset:function(t){window.clearTimeout(t)}}},GAME.Loop.prototype.start=function(){return null!==this.id?this:(this.fn(this.clock.getDelta()),this.timer.set(function(){this.id=null,this.start()}.bind(this)),this)},GAME.Loop.prototype.pause=function(){return null===this.id?this:(this.clock.stop(),this.timer.unset(this.id),this.id=null,this)},GAME.StateMachine=function(){},GAME.StateMachine.prototype.takeState=function(){var t=this.state;return this.state=null,this.state.sleep&&this.state.sleep(),this.state.zzz=!0,t},GAME.StateMachine.prototype.setState=function(t){return this.state&&this.state.destruct&&this.state.destruct(),this.state=t,this.state&&(this.state.zzz?(this.state.zzz=!1,this.state.wakeUp&&this.state.wakeUp()):this.state.construct&&this.state.construct()),this},GAME.StateMachine.prototype.update=function(){return this.state?this.state.update?(this.state.update.apply(this.state,arguments),this):this:this};var GAME=GAME||Object.create(null);GAME.delayedCallback=function(t){var e=[],n=!1,i=0,s=0,o=function(){n&&i===s&&t.apply(null,Array.prototype.concat.apply([],e))};return{step:function(){var t=i++;return function(){e[t]=Array.prototype.slice.call(arguments),s+=1,o()}},release:function(){n=!0,o()}}};var GAME=GAME||Object.create(null);GAME.event=function(t){return{add:function(e){var n=[];return t[e]=function(t){return"function"==typeof t?n.push(t):n.forEach(function(t,e){e.apply(this,t)}.bind(this,arguments)),this},this}}};var GAME=GAME||Object.create(null);GAME.keyboard=function(){var t=Object.create(null);return $(window).on("keydown",function(e){t[e.keyCode]||(t[e.keyCode]={locked:!1})}),$(window).on("keyup",function(e){delete t[e.keyCode]}),{any:function(t){return t.some(this.pressed.bind(this))},pressed:function(e,n){return!t[e]||t[e].locked?!1:(n&&(t[e].locked=!0),!0)}}}();var GAME=GAME||Object.create(null);GAME.mouse=function(){var t=Object.create(null),e=new THREE.Vector2,n=function(t){e.x=t.clientX,e.y=t.clientY};return $(window).on("mousedown",function(e){n(e),t[e.which]={locked:!1}}),$(window).on("mouseup",function(e){n(e),delete t[e.which]}),$(window).on("mousemove",function(t){n(t)}),{position:function(){return e.clone()},pressed:function(e,n){return!t[e]||t[e].locked?!1:(n&&(t[e].locked=!0),!0)}}}();